
# [380. O(1) 时间插入、删除和获取随机元素](https://leetcode.cn/problems/insert-delete-getrandom-o1/)
看题解，用list来确保获取随机数据的时间是O(1)，用map来保证insert和remove的时间是O(1)
```python
class RandomizedSet:
    def __init__(self):
        self.nums = []
        self.indices = {}

    def insert(self, val: int) -> bool:
        if val in self.indices:
            return False
        self.indices[val] = len(self.nums)
        self.nums.append(val)
        return True

    def remove(self, val: int) -> bool:
        if val not in self.indices:
            return False
        id = self.indices[val]
        self.nums[id] = self.nums[-1]
        self.indices[self.nums[id]] = id
        self.nums.pop()
        del self.indices[val]
        return True

    def getRandom(self) -> int:
        return choice(self.nums)
```


# [381. O(1) 时间插入、删除和获取随机元素 - 允许重复](https://leetcode.cn/problems/insert-delete-getrandom-o1-duplicates-allowed/)

把list改成set

```python
from collections import defaultdict
from random import choice

class RandomizedCollection:
    def __init__(self):
        self.nums = []                   # 动态数组：存放所有值（含重复）
        self.pos = defaultdict(set)      # val -> 该值在 nums 中的所有下标集合

    def insert(self, val: int) -> bool:
        # 若 val 之前未出现，返回 True；否则 False
        is_new = val not in self.pos
        self.pos[val].add(len(self.nums))
        self.nums.append(val)
        return is_new

    def remove(self, val: int) -> bool:
        # 若不存在该值，返回 False
        if val not in self.pos:
            return False

        # 取出 val 的一个下标（任意一个即可）
        remove_idx = self.pos[val].pop()
        last_idx = len(self.nums) - 1
        last_val = self.nums[last_idx]

        # 用最后一个元素覆盖到 remove_idx 位置
        self.nums[remove_idx] = last_val
        if remove_idx != last_idx:
            # 更新 last_val 的索引集合：删掉旧的 last_idx，加入新的 remove_idx
            self.pos[last_val].discard(last_idx)
            self.pos[last_val].add(remove_idx)

        # 弹出最后一个
        self.nums.pop()
        # 若 val 已无出现，则删掉该键，保证 insert 的返回语义正确
        if not self.pos[val]:
            del self.pos[val]
        return True

    def getRandom(self) -> int:
        # 因为 nums 中重复值会出现多次，所以返回概率 ∝ 出现次数
        return choice(self.nums)
```